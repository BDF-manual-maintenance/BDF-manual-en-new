Wavefunction Analysis and Property Analysis
================================================

The solutions to the Schrödinger equation consist of two parts: the wavefunction (eigenvector) and the energy (eigenvalue). Both can be utilized for various subsequent analyses to establish connections with chemical concepts and experimental observables.  
These analysis methods fall into three categories: **wavefunction analysis** related to the wavefunction itself, **density analysis** related to the electron density (i.e., the square modulus of the wavefunction), and various **one-electron properties** related to energy derivatives.

BDF supports the following wavefunction analyses:
* Mulliken population analysis and Löwdin population analysis, including atomic net charges and atomic spin densities.

.. _1e-prop:

BDF supports the following one-electron properties:

* **SCF**: Dipole moment, Polarizability*, Hyperpolarizability*, Mössbauer spectroscopy (Effective Contact Density, Electric Field Gradient), Nuclear Magnetic Resonance\*\*
* **TDDFT**: Dipole moment of excited states*, Oscillator strength for fluorescence absorption spectra, Oscillator strength for phosphorescence absorption spectra

  \* Calculated in the ``resp`` module.  
  \*\* Calculated in the ``nmr`` module.

Additional wavefunction analyses, density analyses, and one-electron properties can be performed using third-party programs by generating molden-format data files in the ``scf`` module. Input example:

.. code-block:: bdf

  $scf
  rks
  dft
   b3lyp
  molden
  $end

The standard molden format only supports spdfg-type Gaussian basis functions, but BDF has extended support to include h functions.

Effective Contact Density
------------------------------------------------
Calculating the Effective Contact Density (ED) requires consideration of both relativistic effects (handled in BDF using the X2C Hamiltonian via ``heff`` = 21, 22, or 23) and the finite size of the nucleus (``nuclear`` = 1). An input example at the sf-X2C-AU/B3LYP level is:

.. code-block:: bdf

  $xuanyuan
   heff
    23
   nuclear
    1
  $end

  $scf
   rks
   dft
    b3lyp
   grid
    ultra fine
   reled
    20
  $end

Here, ``reled`` invokes the relativistic property ED calculation. ``20`` specifies that ED is not calculated for light elements with atomic numbers less than 20, saving computational time. For density functional calculations, the ED value is sensitive to the integration grid; it is recommended to use the fine-grid setting ``ultra fine``.

Special basis set treatment is required for ED; see :ref:`Mössbauer Spectrum <mossbauer>`.

Electric Field Gradient
------------------------------------------------
Calculating the Electric Field Gradient (EFG) has similar requirements to ED and uses the keyword ``relefg``. See :ref:`Mössbauer Spectrum <mossbauer>`.

molden2aim
------------------------------------------------
Download: https://github.com/zorkzou/Molden2AIM

molden2aim converts molden files generated by BDF into wfn, wfx, or NBO-47 format data files for various analyses. It supports spdfgh-type Gaussian basis functions and ECPs.

Multiwfn
------------------------------------------------
Download: http://sobereva.com/multiwfn/

Multiwfn is a powerful wavefunction analysis program. Using molden data files generated by BDF (supporting spdfgh basis functions and ECPs) or wfn/wfx files converted via molden2aim, Multiwfn can perform numerous analyses. These include:
* Electron density topological analysis (also known as *Quantum Theory of Atoms in Molecules*; QTAIM)
* Electron Localization Function (ELF)
* Population analysis
* Bond order analysis
* Atomic charge analysis
It can also visualize molecular orbitals, electron density, and various real-space functions. Details are in the Multiwfn manual.

NBO Analysis
------------------------------------------------
BDF currently does not include a direct interface to NBO (https://nbo7.chem.wisc.edu/). However, molden2aim can be used to convert BDF-generated molden files (supporting spdfgh basis functions and ECPs) into NBO-47 format data files. These can then be analyzed using the standalone NBO program `gennbo.exe`.

For RHF/RKS and UHF/UKS type wavefunctions (i.e., MO occupation numbers limited to 0, 1, or 2), NBO can perform "Second Order Perturbation Theory Analysis." This requires the presence of the Fock matrix in the .47 file. Set ``nbopro=1`` in molden2aim's configuration file ``m2a.ini`` to achieve this.

Force Constants in Internal Coordinates
------------------------------------------------
The Hessian matrix (also called the force constant matrix) produced by vibrational frequency calculations represents the second derivative of energy with respect to the 3N Cartesian coordinates of the atoms. Chemically, however, force constants in internal coordinates (e.g., chemical bonds, bond angles, dihedral angles) are often more relevant.  
Third-party programs can "extract" force constants for internal coordinates from the Hessian matrix. These are useful for parameterizing molecular mechanics (MM) calculations or comparing the strengths of chemical bonds and hydrogen bonds.  
A theoretical introduction in Chinese is available at: http://bbs.keinsci.com/thread-28658-1-1.html

1.  **LModeA**: Standalone program written in Fortran90. Requires application to Elfi Kraka: https://s3.smu.edu/dedman/catco/members.html
2.  **LModeA-nano**: A PyMOL plugin supporting local vibrational mode analysis for solids and molecules, calculating force constants and harmonic frequencies for bonds, angles, etc.: https://lmodea-nano.readthedocs.io/en/latest/
3.  **Morfeus**: Standalone program written in Python: https://digital-chemistry-laboratory.github.io/morfeus/index.html

The .umv data file generated by BDF vibrational frequency calculations can be read directly by these programs.